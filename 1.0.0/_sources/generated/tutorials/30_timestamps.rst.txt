
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "generated/tutorials/30_timestamps.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_generated_tutorials_30_timestamps.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_generated_tutorials_30_timestamps.py:


Stream timestamps
=================

.. include:: ./../../links.inc

An LSL stream is composed of samples received at a given time. Each device, each source,
advertises its own time. If the source and the client are on the same physical computer,
e.g. with a :class:`mne_lsl.lsl.StreamOutlet` and a :class:`mne_lsl.lsl.StreamInlet`,
the same clock is used. But if the source and the client are on different computers,
e.g. connected on a local ethernet network, the delay between the source and the client
might be important.

.. GENERATED FROM PYTHON SOURCE LINES 16-28

Estimate the delay
------------------

At a low-level, a :class:`~mne_lsl.lsl.StreamInlet` has a
:meth:`~mne_lsl.lsl.StreamInlet.time_correction` method to estimate the time offset.

.. note::

    For this tutorial purposes, a mock LSL stream is created using a
    :class:`~mne_lsl.player.PlayerLSL`. See
    :ref:`sphx_glr_generated_tutorials_10_player.py` for additional information on
    mock LSL streams.

.. GENERATED FROM PYTHON SOURCE LINES 28-48

.. code-block:: default


    import time

    from matplotlib import pyplot as plt

    from mne_lsl.datasets import sample
    from mne_lsl.lsl import StreamInlet, resolve_streams
    from mne_lsl.player import PlayerLSL as Player
    from mne_lsl.stream import StreamLSL as Stream

    fname = sample.data_path() / "sample-ant-raw.fif"
    player = Player(fname)
    player.start()

    streams = resolve_streams(name=player.name)
    inlet = StreamInlet(streams[0])
    inlet.open_stream()
    print(inlet.time_correction())
    del inlet





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    -1.715000000501732e-05




.. GENERATED FROM PYTHON SOURCE LINES 49-52

With the example above, the time offset is very small because the source
(:class:`~mne_lsl.player.PlayerLSL`) and the client
(:class:`~mne_lsl.lsl.StreamInlet`) are both local, i.e. present on the same computer.

.. GENERATED FROM PYTHON SOURCE LINES 54-59

Timestamps in the Stream API
----------------------------

A :class:`~mne_lsl.stream.StreamLSL` returns both the samples and the associated
timestamps when queried with :meth:`~mne_lsl.stream.StreamLSL.get_data`.

.. GENERATED FROM PYTHON SOURCE LINES 59-69

.. code-block:: default


    stream = Stream(2, name=player.name)
    stream.connect()
    time.sleep(2)
    data, ts = stream.get_data(picks="ECG")
    f, ax = plt.subplots(1, 1, figsize=(10, 5), constrained_layout=True)
    ax.plot(ts, data[0, :])
    ax.set_ylabel("ECG")
    ax.set_xlabel("Timestamps LSL")




.. image-sg:: /generated/tutorials/images/sphx_glr_30_timestamps_001.png
   :alt: 30 timestamps
   :srcset: /generated/tutorials/images/sphx_glr_30_timestamps_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    Text(0.5, 18.166999999999994, 'Timestamps LSL')



.. GENERATED FROM PYTHON SOURCE LINES 70-71

TODO: Add a stream from XDF file with jitter and add the processing flags.

.. GENERATED FROM PYTHON SOURCE LINES 73-78

Free resources
--------------
When you are done with a :class:`~mne_lsl.player.PlayerLSL` or
:class:`~mne_lsl.stream.StreamLSL`, don't forget to free the resources they both use
to continuously mock an LSL stream or receive new data from an LSL stream.

.. GENERATED FROM PYTHON SOURCE LINES 78-81

.. code-block:: default


    stream.disconnect()
    player.stop()




.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    [stream_lsl:_acquire:246] ERROR: 'StreamLSL' object has no attribute '_inlet'
    Traceback (most recent call last):
      File "/opt/hostedtoolcache/Python/3.9.18/x64/lib/python3.9/site-packages/mne_lsl/stream/stream_lsl.py", line 208, in _acquire
        data, timestamps = self._inlet.pull_chunk(timeout=0.0)
    AttributeError: 'StreamLSL' object has no attribute '_inlet'





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 6.306 seconds)

**Estimated memory usage:**  102 MB


.. _sphx_glr_download_generated_tutorials_30_timestamps.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example




    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: 30_timestamps.py <30_timestamps.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: 30_timestamps.ipynb <30_timestamps.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
